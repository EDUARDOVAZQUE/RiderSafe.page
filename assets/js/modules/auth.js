(function(_0x56793e,_0x1c869e){const _0x174f00=a2_0x1c8a,_0x1b0a48=_0x56793e();while(!![]){try{const _0x1f948=parseInt(_0x174f00(0xd4))/0x1+parseInt(_0x174f00(0xbc))/0x2*(parseInt(_0x174f00(0xaf))/0x3)+-parseInt(_0x174f00(0xae))/0x4+parseInt(_0x174f00(0xf2))/0x5+-parseInt(_0x174f00(0xc2))/0x6+parseInt(_0x174f00(0xc6))/0x7+-parseInt(_0x174f00(0x92))/0x8*(parseInt(_0x174f00(0xb2))/0x9);if(_0x1f948===_0x1c869e)break;else _0x1b0a48['push'](_0x1b0a48['shift']());}catch(_0x4cebcc){_0x1b0a48['push'](_0x1b0a48['shift']());}}}(a2_0x4147,0x90150));const a2_0x4ceff1=(function(){let _0x3a5aae=!![];return function(_0x17ed6b,_0x2eda26){const _0x5b08b5=_0x3a5aae?function(){const _0x3abb66=a2_0x1c8a;if(_0x2eda26){const _0x503df0=_0x2eda26[_0x3abb66(0xf3)](_0x17ed6b,arguments);return _0x2eda26=null,_0x503df0;}}:function(){};return _0x3a5aae=![],_0x5b08b5;};}()),a2_0xd01fd0=a2_0x4ceff1(this,function(){const _0x399865=a2_0x1c8a;return a2_0xd01fd0['toString']()[_0x399865(0xc7)](_0x399865(0xd3))['toString']()[_0x399865(0xc5)](a2_0xd01fd0)[_0x399865(0xc7)](_0x399865(0xd3));});a2_0xd01fd0();const a2_0x3ff7df=(function(){let _0x1dc0b4=!![];return function(_0x595130,_0x20f370){const _0x31923b=_0x1dc0b4?function(){const _0x308934=a2_0x1c8a;if(_0x20f370){const _0x24ba52=_0x20f370[_0x308934(0xf3)](_0x595130,arguments);return _0x20f370=null,_0x24ba52;}}:function(){};return _0x1dc0b4=![],_0x31923b;};}());(function(){a2_0x3ff7df(this,function(){const _0x1f43fb=a2_0x1c8a,_0x127875=new RegExp(_0x1f43fb(0xa5)),_0x15994d=new RegExp('\x5c+\x5c+\x20*(?:[a-zA-Z_$][0-9a-zA-Z_$]*)','i'),_0x9dbed1=a2_0x3a92de('init');!_0x127875[_0x1f43fb(0xf5)](_0x9dbed1+_0x1f43fb(0xdd))||!_0x15994d[_0x1f43fb(0xf5)](_0x9dbed1+_0x1f43fb(0xb9))?_0x9dbed1('0'):a2_0x3a92de();})();}());const a2_0x1d393d=(function(){let _0x5d023c=!![];return function(_0x534965,_0x14bf73){const _0x4b37a6=_0x5d023c?function(){if(_0x14bf73){const _0xf2fc3a=_0x14bf73['apply'](_0x534965,arguments);return _0x14bf73=null,_0xf2fc3a;}}:function(){};return _0x5d023c=![],_0x4b37a6;};}()),a2_0x56be9c=a2_0x1d393d(this,function(){const _0x508303=a2_0x1c8a,_0xd06994=function(){const _0xc081e3=a2_0x1c8a;let _0x5abb27;try{_0x5abb27=Function(_0xc081e3(0xe5)+_0xc081e3(0xd1)+');')();}catch(_0x8207cc){_0x5abb27=window;}return _0x5abb27;},_0x1f6fd6=_0xd06994(),_0x181b1f=_0x1f6fd6[_0x508303(0xa6)]=_0x1f6fd6[_0x508303(0xa6)]||{},_0x4edc33=[_0x508303(0xb4),_0x508303(0xb7),_0x508303(0xb6),'error',_0x508303(0x91),_0x508303(0xd2),_0x508303(0x99)];for(let _0x2186e0=0x0;_0x2186e0<_0x4edc33[_0x508303(0xa0)];_0x2186e0++){const _0x3a13d7=a2_0x1d393d[_0x508303(0xc5)][_0x508303(0xbe)][_0x508303(0xac)](a2_0x1d393d),_0x39c6f8=_0x4edc33[_0x2186e0],_0x48c6bf=_0x181b1f[_0x39c6f8]||_0x3a13d7;_0x3a13d7[_0x508303(0xc0)]=a2_0x1d393d[_0x508303(0xac)](a2_0x1d393d),_0x3a13d7['toString']=_0x48c6bf[_0x508303(0xf9)][_0x508303(0xac)](_0x48c6bf),_0x181b1f[_0x39c6f8]=_0x3a13d7;}});function a2_0x1c8a(_0x2acea3,_0x4d6f9a){const _0x334c74=a2_0x4147();return a2_0x1c8a=function(_0x56be9c,_0x1d393d){_0x56be9c=_0x56be9c-0x8f;let _0x5a77dd=_0x334c74[_0x56be9c];return _0x5a77dd;},a2_0x1c8a(_0x2acea3,_0x4d6f9a);}a2_0x56be9c();import{auth,db}from'../config/firebase-config.js';import{signInWithEmailAndPassword,createUserWithEmailAndPassword,signOut,onAuthStateChanged,sendEmailVerification,sendPasswordResetEmail}from'https://www.gstatic.com/firebasejs/12.2.1/firebase-auth.js';import{doc,setDoc,getDoc,runTransaction}from'https://www.gstatic.com/firebasejs/12.2.1/firebase-firestore.js';let currentUser=null;export function initAuth(){onAuthStateChanged(auth,_0x465f99=>{const _0x455189=a2_0x1c8a;if(_0x465f99&&_0x465f99[_0x455189(0x9d)])currentUser=_0x465f99;else!_0x465f99&&(currentUser=null);updateAuthUI(currentUser);});}function updateAuthUI(_0x3e2591){const _0x205a37=a2_0x1c8a,_0x5c8e53=document[_0x205a37(0xd5)]('loginBtn'),_0x4ba908=document[_0x205a37(0xd5)](_0x205a37(0x96)),_0x2e158a=document[_0x205a37(0xd5)]('dashboardLink'),_0x246f7d=document[_0x205a37(0xd5)](_0x205a37(0xaa)),_0x1e87a1=document['getElementById'](_0x205a37(0x95)),_0xa6cb5b=!!_0x3e2591;if(_0x5c8e53)_0x5c8e53['style'][_0x205a37(0xea)]=_0xa6cb5b?'none':_0x205a37(0xa4);if(_0x4ba908)_0x4ba908[_0x205a37(0x9b)][_0x205a37(0xea)]=_0xa6cb5b?_0x205a37(0xa4):_0x205a37(0xdf);if(_0x2e158a)_0x2e158a[_0x205a37(0x9b)]['display']=_0xa6cb5b?_0x205a37(0xa4):_0x205a37(0xdf);_0x246f7d&&(_0x246f7d[_0x205a37(0x9b)][_0x205a37(0xea)]=_0xa6cb5b?_0x205a37(0xa4):_0x205a37(0xdf)),_0x1e87a1&&(_0x1e87a1[_0x205a37(0x9b)][_0x205a37(0xea)]=_0xa6cb5b?'none':_0x205a37(0xa4));}export async function login(_0xdfdcb6,_0x103a82){const _0x473219=a2_0x1c8a;try{const _0x45db6d=await signInWithEmailAndPassword(auth,_0xdfdcb6,_0x103a82),_0x589f96=_0x45db6d[_0x473219(0xcd)];if(!_0x589f96[_0x473219(0x9d)])return await signOut(auth),{'success':![],'error':_0x473219(0xf6)};return closeAuthModal(),{'success':!![],'user':_0x45db6d['user']};}catch(_0xd316cc){return console['error'](_0x473219(0xc4),_0xd316cc[_0x473219(0xf4)]),{'success':![],'error':getAuthErrorMessage(_0xd316cc)};}}export async function register(_0x7d3929,_0x183a11,_0x420eb6){const _0x13d7dc=a2_0x1c8a;try{const _0x460600=await createUserWithEmailAndPassword(auth,_0x183a11,_0x420eb6),_0x46ec56=_0x460600[_0x13d7dc(0xcd)];return await sendEmailVerification(_0x46ec56),await setDoc(doc(db,'usuarios',_0x46ec56[_0x13d7dc(0xa8)]),{'fullName':_0x7d3929,'email':_0x46ec56[_0x13d7dc(0xe3)],'createdAt':new Date()[_0x13d7dc(0xe4)](),'purchasedProducts':[],'activationCodes':[],'vehicles':[]}),await signOut(auth),{'success':!![],'message':_0x13d7dc(0xd8)};}catch(_0xdc1600){return console[_0x13d7dc(0xe6)]('[Auth]\x20Error\x20en\x20registro:',_0xdc1600[_0x13d7dc(0xf4)]),{'success':![],'error':getAuthErrorMessage(_0xdc1600)};}}export async function resetPassword(_0xc20c08){const _0x45eff3=a2_0x1c8a;try{return await sendPasswordResetEmail(auth,_0xc20c08),{'success':!![],'message':'Enlace\x20de\x20reestablecimiento\x20enviado.\x20Revisa\x20tu\x20correo.'};}catch(_0x18c28){return console[_0x45eff3(0xe6)]('[Auth]\x20Error\x20en\x20reset\x20password:',_0x18c28['code']),{'success':![],'error':getAuthErrorMessage(_0x18c28)};}}export async function logout(){const _0x52d34c=a2_0x1c8a;try{await signOut(auth),window[_0x52d34c(0x9e)]['pathname'][_0x52d34c(0x8f)](_0x52d34c(0xe2))&&(window[_0x52d34c(0x9e)][_0x52d34c(0xa9)]='../index.html');}catch(_0x390480){console[_0x52d34c(0xe6)](_0x52d34c(0xec),_0x390480);}}export function getCurrentUser(){return currentUser;}export async function getUserData(_0x4702fb){const _0x3dd8a3=a2_0x1c8a;if(!_0x4702fb)return null;try{const _0x499f8d=await getDoc(doc(db,_0x3dd8a3(0xf8),_0x4702fb));return _0x499f8d[_0x3dd8a3(0xda)]()?_0x499f8d[_0x3dd8a3(0x90)]():null;}catch(_0x305856){return console[_0x3dd8a3(0xe6)](_0x3dd8a3(0x9c),_0x305856),null;}}export const checkAuthStatus=()=>{return new Promise(_0x248bf7=>{const _0x47b95d=onAuthStateChanged(auth,_0x556286=>{const _0x109933=a2_0x1c8a;_0x47b95d(),_0x556286&&_0x556286[_0x109933(0x9d)]?_0x248bf7(_0x556286):_0x248bf7(null);});});};function closeAuthModal(){const _0x4bca29=a2_0x1c8a,_0x4ecb33=document[_0x4bca29(0xd5)]('authModal');if(_0x4ecb33&&window[_0x4bca29(0x94)]){const _0x253634=window[_0x4bca29(0x94)][_0x4bca29(0xc9)][_0x4bca29(0xbd)](_0x4ecb33);if(_0x253634)_0x253634[_0x4bca29(0xee)]();}}function getAuthErrorMessage(_0x3d7130){const _0x404467=a2_0x1c8a;switch(_0x3d7130['code']){case _0x404467(0xa3):case _0x404467(0xd6):case'auth/invalid-credential':return _0x404467(0xd0);case _0x404467(0xed):return _0x404467(0xf1);case _0x404467(0xe7):return _0x404467(0xb1);case _0x404467(0xd7):return _0x404467(0xce);case'auth/too-many-requests':return _0x404467(0xa7);default:return _0x404467(0xc3);}}function a2_0x4147(){const _0x491d51=['[Auth]\x20Error\x20obteniendo\x20datos\x20del\x20usuario:','emailVerified','location','[Auth]\x20Error\x20en\x20activación:','length','call','message','auth/user-not-found','block','function\x20*\x5c(\x20*\x5c)','console','Demasiados\x20intentos\x20fallidos.\x20Inténtalo\x20de\x20nuevo\x20más\x20tarde.','uid','href','paypal-form','activationCodes','bind','active','728264PxSppd','951513yQdMnj','dispositivos','Este\x20correo\x20electrónico\x20ya\x20está\x20registrado.','9drlhWO','vehicle_','log','stateObject','info','warn','PLUS','input','toUpperCase','licencias','4CljmvO','getInstance','prototype','action','__proto__','vehicles','237192dePauV','Ocurrió\x20un\x20error\x20inesperado.\x20Por\x20favor,\x20intenta\x20de\x20nuevo.','[Auth]\x20Error\x20en\x20login:','constructor','5038831LfXOCo','search','set','Modal','debu','Code\x20collision','0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ','user','La\x20contraseña\x20debe\x20tener\x20al\x20menos\x206\x20caracteres.','Error\x20al\x20generar\x20código\x20único.','Correo\x20electrónico\x20o\x20contraseña\x20incorrectos.','{}.constructor(\x22return\x20this\x22)(\x20)','table','(((.+)+)+)+$','148069fuCXRx','getElementById','auth/wrong-password','auth/weak-password','¡Registro\x20exitoso!\x20Revisa\x20tu\x20correo\x20electrónico\x20para\x20verificar\x20tu\x20cuenta.','string','exists','random','plan','chain','join','none','userId','Código\x20de\x20activación\x20inválido\x20o\x20no\x20encontrado.','dashboard','email','toISOString','return\x20(function()\x20','error','auth/email-already-in-use','gger','El\x20código\x20está\x20asignado\x20a\x20otro\x20usuario.','display','while\x20(true)\x20{}','[Auth]\x20Error\x20en\x20logout:','auth/invalid-email','hide','Error\x20al\x20activar.','Error\x20crítico:','El\x20formato\x20del\x20correo\x20electrónico\x20no\x20es\x20válido.','2544935INULsU','apply','code','test','Tu\x20cuenta\x20aún\x20no\x20ha\x20sido\x20verificada.\x20Por\x20favor,\x20revisa\x20tu\x20correo.','basic','usuarios','toString','includes','data','exception','9595784QKDTtN','counter','bootstrap','login-warning','logoutBtn','floor','get','trace','now','style'];a2_0x4147=function(){return _0x491d51;};return a2_0x4147();}function generateLicenseCode(_0x2fa567=0x10){const _0x230b2c=a2_0x1c8a,_0x2a4fc6=_0x230b2c(0xcc);let _0xc49f85='';for(let _0x185df3=0x0;_0x185df3<_0x2fa567;_0x185df3++){_0xc49f85+=_0x2a4fc6['charAt'](Math[_0x230b2c(0x97)](Math[_0x230b2c(0xdb)]()*_0x2a4fc6[_0x230b2c(0xa0)]));}return _0xc49f85['match'](/.{1,4}/g)[_0x230b2c(0xde)]('-');}export async function registerNewLicense(_0x4e2fa9,_0x2ed821,_0x46e85d){const _0x44dfd5=a2_0x1c8a;let _0xb85519=![],_0x4a50a5=0x0,_0x3716fc='';const _0x4d8f58=0x5;while(!_0xb85519&&_0x4a50a5<_0x4d8f58){_0x4a50a5++,_0x3716fc=generateLicenseCode(0x10);const _0x4d49c6=doc(db,_0x44dfd5(0xbb),_0x3716fc);try{await runTransaction(db,async _0xcb2734=>{const _0x1051c0=_0x44dfd5,_0x5cfa00=await _0xcb2734['get'](_0x4d49c6);if(_0x5cfa00['exists']())throw new Error('Code\x20collision');_0xcb2734[_0x1051c0(0xc8)](_0x4d49c6,{'purchaseId':_0x4e2fa9,'userId':_0x2ed821,'plan':_0x46e85d,'active':![],'activationCode':_0x3716fc,'generatedOn':new Date()[_0x1051c0(0xe4)]()});}),_0xb85519=!![],console[_0x44dfd5(0xb4)]('Licencia\x20'+_0x3716fc+'\x20generada.');}catch(_0x5891a3){if(_0x5891a3[_0x44dfd5(0xa2)]!==_0x44dfd5(0xcb))return console[_0x44dfd5(0xe6)](_0x44dfd5(0xf0),_0x5891a3),{'success':![],'error':_0x5891a3[_0x44dfd5(0xa2)]};}}return _0xb85519?{'success':!![],'code':_0x3716fc}:{'success':![],'error':_0x44dfd5(0xcf)};}export async function activateProductCode(_0x41b653){const _0x34e404=a2_0x1c8a,_0x2ab4aa=getCurrentUser();if(!_0x2ab4aa)return{'success':![],'error':'Debes\x20iniciar\x20sesión\x20para\x20activar\x20un\x20código.'};const _0x24b493=doc(db,_0x34e404(0xbb),_0x41b653),_0x4ceb83=doc(db,_0x34e404(0xf8),_0x2ab4aa[_0x34e404(0xa8)]);try{let _0xe83426=null;const _0x3e4900=_0x34e404(0xb3)+_0x2ab4aa['uid']+'_'+Date[_0x34e404(0x9a)]();return await runTransaction(db,async _0x17cee7=>{const _0x4fd866=_0x34e404,_0x2bbdcd=await _0x17cee7[_0x4fd866(0x98)](_0x24b493),_0x1b29d8=await _0x17cee7['get'](_0x4ceb83);if(!_0x2bbdcd[_0x4fd866(0xda)]())throw new Error(_0x4fd866(0xe1));const _0x5b71f5=_0x2bbdcd[_0x4fd866(0x90)]();if(_0x5b71f5[_0x4fd866(0xad)]===!![])throw new Error('Este\x20código\x20ya\x20ha\x20sido\x20activado\x20y\x20consumido.');if(_0x5b71f5[_0x4fd866(0xe0)]&&_0x5b71f5[_0x4fd866(0xe0)]!==_0x2ab4aa[_0x4fd866(0xa8)])throw new Error(_0x4fd866(0xe9));_0xe83426=_0x5b71f5[_0x4fd866(0xdc)]||(_0x41b653[_0x4fd866(0xba)]()[_0x4fd866(0x8f)](_0x4fd866(0xb8))?'plus':_0x4fd866(0xf7));const _0x271769=_0x1b29d8['data']()||{};_0x17cee7['update'](_0x24b493,{'active':!![],'activatedAt':new Date()[_0x4fd866(0xe4)](),'vehicleId':_0x3e4900,'userId':_0x2ab4aa['uid'],'plan':_0xe83426}),_0x17cee7[_0x4fd866(0xc8)](doc(db,_0x4fd866(0xb0),_0x3e4900),{'userId':_0x2ab4aa[_0x4fd866(0xa8)],'licenseId':_0x41b653,'bateria':0x55,'inclinacion':0x0,'velocidad':0x0,'ubicacion':{'latitude':20.138,'longitude':-99.2015},'timestamp':new Date()[_0x4fd866(0xe4)]()}),_0x17cee7['update'](_0x4ceb83,{'vehicles':[..._0x271769[_0x4fd866(0xc1)]||[],_0x3e4900],'activationCodes':[..._0x271769[_0x4fd866(0xab)]||[],_0x41b653],'purchasedProducts':[..._0x271769['purchasedProducts']||[],'ridersafe-'+_0xe83426]});}),{'success':!![],'plan':_0xe83426};}catch(_0x53e834){return console[_0x34e404(0xe6)](_0x34e404(0x9f),_0x53e834[_0x34e404(0xa2)]),{'success':![],'error':_0x53e834['message']||_0x34e404(0xef)};}}function a2_0x3a92de(_0x7d58d5){function _0x5af02c(_0x16c803){const _0x2d7477=a2_0x1c8a;if(typeof _0x16c803===_0x2d7477(0xd9))return function(_0x335677){}[_0x2d7477(0xc5)](_0x2d7477(0xeb))[_0x2d7477(0xf3)](_0x2d7477(0x93));else(''+_0x16c803/_0x16c803)[_0x2d7477(0xa0)]!==0x1||_0x16c803%0x14===0x0?function(){return!![];}[_0x2d7477(0xc5)](_0x2d7477(0xca)+_0x2d7477(0xe8))[_0x2d7477(0xa1)](_0x2d7477(0xbf)):function(){return![];}[_0x2d7477(0xc5)](_0x2d7477(0xca)+_0x2d7477(0xe8))['apply'](_0x2d7477(0xb5));_0x5af02c(++_0x16c803);}try{if(_0x7d58d5)return _0x5af02c;else _0x5af02c(0x0);}catch(_0x582dd0){}}